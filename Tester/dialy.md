# 12/22 1日目

## 問題概要

- 手札にカードがN枚あり、実行中のプロジェクトがM種類ある
	- カードは5種類ある
		- プロジェクトを進める労働カード2種類
		- プロジェクトをキャンセルして入れ替えるキャンセルカード2種類
		- プロジェクトと手札を強くする増資カード1種類
	- プロジェクトは残務量と価値を持つ
- 以下の操作をTターン行う
	- 手札を1枚使ってプロジェクトに変化を起こす
	- 新しいカードをK枚の中から1枚購入して手札に加える。
		- 1つは無料の通常労働カードであり、性能が一定
	- プロジェクトがM枚に満たなくなった分、ランダムにプロジェクトを補充する

## コーディング前の第一感めも

- すげー機械学習ゲーじゃね？
  - ちゃんと確率分布考えて解いていけば行けるのかなあ
  - あんまりヒューリスティック要素なさそう。愚直にとく。
    - 第一感真面目に計算するゲームに見えるからそんな面白くなさそうなんだけど、tomerunさんそんな問題出さないよな。多分ちゃんとやると面白い。
    - C#で戦いやすそうだなー、と思いつつ、MCTSは割と有力そうな手段っぽいのでやっぱ時間使うのかなあ。
- 何をすれば点数が伸びるんだ？
	- 増資カードがあるので倍々に点数が伸びていきそう？
	- 増資カードって強いのか？
		- 基本的に1ターン点数は、 (プロジェクト価値 / プロジェクト残務量) * 平均労働力
		- 増資カードによる変化は以下
			- プロジェクト価値は2倍
			- プロジェクト残務量も2倍
			- 平均労働力も2倍
		- じゃあ2倍やんけ。強い。
		- 無理して増資して金がなくなる、が弱いかも。要検討
	- 無料カードは強いのか？
		- L = 0で考える どうせ全部増えるのでLによって結論は変わらないはず。
			- 無料カードで得られる労働力を1とする
			- b=(2.0, 8.0)より、平均必要労働量が5くらい
			- 価値vなにこれ。わからん。
			- 分布出して見るか
    			- ![b=2](pic/b2.png)
    			- ![b=5](pic/b5.png)
    			- ![b=8](pic/b8.png)
  			- 分布大体全部一緒かな……？
  			- 残務量の平均はまぁ2^b/2くらいで、この分布が大体2^b
    			- とりあえず平均価値3で見積もっておくか
        			- 中央値は2だけど上振れが大きいので。 
			- 通常労働カードで得られる平均労働力は25、コストも25くらい
			- 1枚買って使用する価値は、
				- 無料カード: 2ターンで価値4の生産
				- 通常労働カード: 2ターンで価値75の生産
			- 無料カードクッソ弱い！
    - 通常労働カードと全力労働カードの比較
      - どんくらい全部のタスクをやるかによる気がする……
        - でも基本的に全力労働カードの方が強そう
        - 上の考察からたくさんお金使ってたくさん進めた方が吉っぽいし
      - キャンセル系カードの方が先に考察すべきっぽい？
    - キャンセルカードの価値
      - まずは分布が大切
        - 労働カードの分布から
          - 適当に平均30, 分散10のグラフを出してみる
            - ![ガウス分布](pic/gauss.png)
            - 効率に倍の差はつかなさそう？
        - プロジェクト1個を消費するために必要な平均ターン数は？
          - 通常労働の労働平均が25　（無料を1とする）
          - 全力労働の労働平均が25 * M
          - プロジェクトの残務平均が、b=5を採用するとして、32くらい
            - 1ターンとか2ターンとかで終わらね……？
          - キャンセルしてる暇があったら倒せ、みたいになりそうな気がする
            - 無料カードよりは流石に強い気がするけど。
            - K = 2とかでは買うし買うということは使う
    - 業務転換は？
      - かなり使いどころむずかしい
      - Mが多いときは全力労働が多分めちゃ強くない？
        - ってことは全力労働でプロジェクトがどんどん変わっていくので、やりかけプロジェクトが増えそう
          - ってことはキャンセルしたくないのが増えそう
      - 使いどころむずかしそうだなあ。すごい使いたいタイミングが来たら買うけど……くらい。
  - 何をやるにせよ強めの貪欲が必要な気がする
    - MCTSしたいんだけど、MCTSするには貪欲が強いのが絶対条件
      - とりあえず貪欲を組もう！
- 貪欲の組み方
  - とりあえずカード自体の価値とカード使用時に生み出す価値を適当に計算すれば良さそう。
    - カード価値高く見積もり過ぎるとカード使わなくなっちゃうので、カード価値の価値をちょっと低めに見積もって、いいカードどんどん使う感じにするのが良さげ

ここまでコード書かずにまったり考えて2時間くらい。短期コンだと絶対出来ない取り組み方だなあ。

- 増資カードってすぐに使っていいの？
  - 実はダメじゃね？と思い始めてる。カード購入にダイレクトに効いてくる
  - 増資カードを貯め込んで一気に増資！って戦略あるじゃんこれ
    - 増資カードの出現頻度や手札の数によっては温存あるわこれ
      - あるか？ ないかも
      - Lがいくつになってるかより、増資カードの入手数+Lが大切だったりしない？
        - するかも
      - そんな考えなくていいかも。
        - 基本即使用で実装しようと思ってたけど、一応やめようかな……。
        - 貪欲にやる時は即使用でいいと思う


### Submit 1：23.207 3位

- 雑にステータスの評価値を書いて、それを元に貪欲をした
- その後、何ターンか適当にシミュレートしてみるのを書いて提出した
  - 適当に840ケースくらい試した。そんなに変わらないっぽい
  - 0001がサンプル、0002が貪欲のみ、0003がランダム生成したデータで先読み
    - ![スコア](pic/score1.png)
- 先読みの時にXを学習してみたけど意味なし。ぐぬぬ。
- 手元でサンプルが0.027なのに対して順位表だと0.662くらいある気がしてる。これデータ生成ちゃんとあってる？
  - なんかやたら合計点数が少ない気がする
  - ProjectやらmoneyやらがオーバーフローしてそうΣ
    - 大きいテストで0点続出だったっぽい……？
    - ![スコア](pic/score2.png)
  - でもTesterだと大半L=20になるのにvisualizerからとってきたデータだと大半L=20いかないなあ。謎。
  
### Submit 2：27.404 2位

- 良い貪欲を見つけるゲーでクソみたいな貪欲書いてるからまぁまだ大した点数が出ないのは当然だけど、上にKiriさんがいるのはさすがだなあ(37.670)
- テスト改善したいけどその前にローカルと実際のテストデータにめっちゃ差があるのをなおしたい！
  - 調べてみたら普通に生成ミスでした。
  - サンプルが0.68点に。ってことは小さいケースでも普通に負けてるね。

- 色々直したけど貪欲と大差ないものしか出来て無くない？
  - ただの貪欲によく負ける。そもそもやり方がまずい？
  - ちょっと長い時間回してみるかあ。実行時間10倍を0007で。
  - 10倍 vs 通常 vs 貪欲 = 86 vs 62 vs 50になった
    - 10倍強いけどKiriさんが130くらいのスコア出してるんだよなあ……。
    - やっぱ貪欲単体で100くらい出せる計算式にしないとダメそうな気がする。

- 状態の評価がむずい
  - 以下の要素を評価しないといけない
    - 残金
    - レベル
    - 残りターン
    - 残っているプロジェクト
    - 残っているカード
  - 順番に考えてみる
    - 残金
      - そのまま……でいいのか？
      - 残り金額が少なくて身動きが取れない状態にはペナルティを与えたさがある
    - レベルと残りターン
      - レベルは基本的にすぐ上げたいけど上に書いてある残り金額パターンだけ怖い
      - 残りターンはレベルと合わせて処理することが多め。最後だけ動きが特殊だけど本質的じゃないと思う
      - (2^レベル)*残りターン*適当な定数、とかを補正で入れとけば大体あげたいし後半やめとこってなりそう
    - 残っているプロジェクト
      - 残りHPと価値Vについて考えた時に、
        - 基本的にこのゲームは価値と労働力が釣り合ってるわけで、HP>Vのものはゴミ
        - ってことは大体 V - HPがそのプロジェクトの価値
          - でもこれだとどれ削っても価値が同じってことになっちゃう
        - そのプロジェクトの完遂したさ度合い、みたいなのを入れる？
          - 絶対入れる→1
          - 積極的ではないけどまぁやっても良い→0.8
          - こんなん使わん→0.5
            - 存在することがマイナスの価値だよ、というのをちゃんと示すために0にしない方が良さそう
              - キャンセルカードとかのため
              - 業務転換カードが有効に使えることはあるのか……？
          - なんかいい感じに傾斜つけたいな
            - V=HPのとき0.8
            - HP=0のとき1
            - 1-HP/V*0.2で良い？
              - こういうの事例出して考えないとわかんなくなる
              - プロジェクトが4つ
                - V=100, HP=3
                - V=100, HP=101
                - V=100, HP=200
                - V=10, HP=3
              - それぞれ重要度計算して(V-HP)掛けるとこんな感じ
                - 重要度: 0.994	 価値: 96.418
                - 重要度: 0.798	価値: -0.798
                - 重要度: 0.600 価値: -60.00
                - 重要度: 0.94 価値: 6.58
              - それぞれにPower=2を使う
                - 重要度: 0.998 価値: 98.802 価値上昇:2.384
                - 重要度: 0.802 価値: 0.802 価値上昇:1.6
                - 重要度: 0.604 価値: -59.192 価値上昇:0.808
                - 重要度: 0.98 価値: 8.82 価値上昇:2.24
              - 良さそう。ちゃんとHP少ないやつが先に使われるし、Vがでかい方が使われている。
    - 残っているカード
      - 通常カード
        - 価値=Powerで基本良い
          - 上の重要度の関係で価値上昇が序盤小さくなってるのが難しい
            - 価値=2の時、上の例で言うと、1,4番目には使えるけど2,3番目には使えなくなっちゃう
              - 3には使えなくていいけど2には使った方が良さげだよね。
            - 重要度と対応させる意味では


# 12/23 2日目
- 寝る前に実行時間10倍と100倍を試してみた
  - ![スコア](pic/score3.png)
  - 実行時間足りてないだけやんけ！！！
  - ほんと？
    - 並列実行が悪さしてるかもね

				


